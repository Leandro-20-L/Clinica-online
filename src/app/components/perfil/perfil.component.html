<div class="perfil-card">
  <img [src]="usuario?.imagen1 || 'assets/imgs/default-user.png'" alt="Foto de perfil" class="perfil-img" />

  <h2>{{ usuario?.nombre | capitalizar }} {{ usuario?.apellido | capitalizar}}</h2>

  <span
    class="rol-badge"
    [ngClass]="{
      paciente: rol === 'paciente',
      especialista: rol === 'especialista',
      admin: rol === 'admin'
    }"
  >
    {{ rol | titlecase }}
  </span>

  <p><strong>DNI:</strong> {{ usuario?.dni | ocultarParcial:4 }}</p>
  <p><strong>Correo:</strong> {{ usuario?.mail }}</p>

  
  <p *ngIf="rol === 'paciente' && usuario?.obra_social">
    <strong>Obra Social:</strong> {{ usuario.obra_social | mayus }}
  </p>

  <div *ngIf="rol === 'paciente'" class="historia-clinica-accion">
  <button class="btn-historias" (click)="verHistoriaClinica()">
    Ver historia clínica
  </button>
</div>

  
  <p *ngIf="rol === 'especialista' && especialidades.length > 0">
  <strong>Especialidades:</strong> {{ especialidades.join(', ') }}
</p>
<p *ngIf="rol === 'especialista' && especialidades.length === 0">
  <strong>Especialidades:</strong> No configuradas
</p>

  
  <p *ngIf="rol === 'admin'">
    <strong>Rol:</strong> Administrador del sistema
  </p>

  <button class="btn-cerrar" (click)="volver()">
  <img src="svgs/salir.svg" alt="">
</button>
<!--
<div *ngIf="rol === 'especialista'" class="horarios-section">
  <button class="btn-horarios" (click)="abrirModalHorarios()">
    Configurar disponibilidad horaria
  </button>
</div>
-->
<!-- Modal -->

<div class="horarios-config-container" *ngIf="rol === 'especialista'">
  <h3>Disponibilidad horaria</h3>

  <div class="horario-row" *ngFor="let dia of diasSemana">
    <!-- Día -->
    <div class="col-dia">
      <span class="dia-label">{{ dia }}</span>
    </div>

    <!-- Switch -->
    <div class="col-switch">
      <label class="switch">
        <input
          type="checkbox"
          [(ngModel)]="disponibilidad[dia].disponible"
        />
        <span class="slider"></span>
      </label>
    </div>

    <!-- Inputs de tiempo -->
    <div
      class="col-horas"
      [class.disabled]="!disponibilidad[dia].disponible"
    >
      <div class="hora-field">
        <span class="label">Desde</span>
        <input
          type="time"
          [min]="minHora"
          [max]="maxHora"
          step="1800"
          [(ngModel)]="disponibilidad[dia].desde"
          [disabled]="!disponibilidad[dia].disponible"
          (change)="normalizarHora(dia, 'desde')"
        />
      </div>

      <div class="hora-field">
        <span class="label">Hasta</span>
        <input
          type="time"
          [min]="minHora"
          [max]="maxHora"
          step="1800"
          [(ngModel)]="disponibilidad[dia].hasta"
          [disabled]="!disponibilidad[dia].disponible"
          (change)="normalizarHora(dia, 'hasta')"
        />
      </div>
    </div>

    <!-- Resumen -->
    <div class="col-resumen"
         *ngIf="disponibilidad[dia].disponible &&
                disponibilidad[dia].desde &&
                disponibilidad[dia].hasta">
      <span class="resumen">
        {{ disponibilidad[dia].desde }} - {{ disponibilidad[dia].hasta }}
      </span>
    </div>
  </div>

  <div class="error-horarios" *ngIf="errorHorarios">
    {{ errorHorarios }}
  </div>

  <button class="btn-guardar" (click)="guardarHorarios()">
    Guardar disponibilidad
  </button>
</div>




</div>

<app-historia-clinica
  *ngIf="mostrarHistoria"
  [paciente]="usuario"
  [historias]="historiasPaciente"
  [cerrar]="cerrarHistoriaClinica.bind(this)"
  [descargarPdf]="descargarPdfHistoria.bind(this)"
   [descargarPdfEspecialista]="generarPDFDeEspecialista.bind(this)"
    [descargarPdfCompleta]="descargarHistoriaCompleta.bind(this)"
     [descargarPdfPorEspecialidad]="descargarPdfPorEspecialidad.bind(this)"
     [habilitarFiltrosPorEspecialidad]="true">
</app-historia-clinica>