<div class="especialista-container">
  <header class="header">
    <div class="info">
      <h2>Bienvenido, {{ especialista?.nombre }}</h2>
    </div>

    <div class="acciones-header">
      <button class="btn-perfil" (click)="irAPerfil()">
        <img src="usuarios/user.svg" alt="Perfil" />
        <span>Mi perfil</span>
      </button>

      <button class="btn-logout" (click)="logout()">
        <img src="svgs/logout.svg" alt="Cerrar sesi칩n" />
        <span>Cerrar sesi칩n</span>
      </button>
    </div>
  </header>

  <!-- 游댌 BUSCADOR -->
  <input
    type="text"
    placeholder="Buscar por especialidad / paciente..."
    [(ngModel)]="filtroTexto"
    (input)="filtrarTurnos()"
    class="input-buscar"
  />

  <!-- 游댖 FILTROS -->
  <section class="filtros">
    <button [class.activo]="filtro === 'pendiente'" (click)="cambiarFiltro('pendiente')">Pendientes</button>
    <button [class.activo]="filtro === 'aceptado'" (click)="cambiarFiltro('aceptado')">Aceptados</button>
    <button [class.activo]="filtro === 'rechazado'" (click)="cambiarFiltro('rechazado')">Rechazados</button>
    <button [class.activo]="filtro === 'realizado'" (click)="cambiarFiltro('realizado')">Realizados</button>
  </section>

  <!-- LISTA DE TURNOS -->
  <section class="turnos-lista">
    <div *ngIf="turnosFiltrados.length; else sinTurnos">
      <div class="turno-card" *ngFor="let turno of turnosFiltrados">

        <h3>{{ turno.especialidad }}</h3>
        <p><strong>Paciente:</strong> {{ turno.usuarios?.nombre }} {{ turno.usuarios?.apellido }}</p>
        <p><strong>Fecha:</strong> {{ turno.fecha | date: 'dd/MM/yyyy' }}</p>
        <p><strong>Hora:</strong> {{ turno.hora }}</p>
        <p class="estado" [ngClass]="turno.estado">{{ turno.estado | titlecase }}</p>

        <!-- 游댲 Acciones seg칰n estado -->
        <div class="acciones" *ngIf="turno.estado === 'pendiente'">
          <button class="btn-aceptar" (click)="aceptarTurno(turno)">Aceptar</button>
          <button class="btn-rechazar" (click)="rechazarTurno(turno)">Rechazar</button>
        </div>

        <div class="acciones" *ngIf="turno.estado === 'aceptado'">
          <button class="btn-realizado" (click)="marcarRealizado(turno)">Marcar realizado</button>
        </div>

        <div class="acciones" *ngIf="turno.estado === 'realizado' && turno.resena === null">
          <button class="btn-resenia" (click)="abrirResenia(turno)">Cargar rese침a</button>
        </div>

        <div *ngIf="turno.resena">
          <p><strong>Rese침a cargada:</strong> {{ turno.resena }}</p>
        </div>

      </div>
    </div>

    <ng-template #sinTurnos>
      <p class="sin-turnos">No hay turnos en esta categor칤a.</p>
    </ng-template>
  </section>

  <!-- MODAL RESE칌A -->
  <div class="modal-overlay" *ngIf="modalAbierto">
    <div class="modal">
      <h3>{{ modalTitulo }}</h3>

      <textarea [(ngModel)]="textoResenia" placeholder="Escriba su rese침a..."></textarea>

      <button class="btn-guardar" (click)="guardarResenia()">Guardar rese침a</button>

      <button class="btn-cerrar-modal" (click)="cerrarModal()">Cerrar</button>
    </div>
  </div>
</div>
