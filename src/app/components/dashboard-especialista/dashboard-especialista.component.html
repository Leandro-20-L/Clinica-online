<div class="especialista-container">
  <header class="header">
    <div class="info">
      <h2>Bienvenido, {{ especialista?.nombre }}</h2>
    </div>

    <div class="acciones-header">
      <button class="btn-perfil" (click)="irAPerfil()">
        <img src="usuarios/user.svg" alt="Perfil" />
        <span>Mi perfil</span>
      </button>

      <button class="btn-logout" (click)="logout()">
        <img src="svgs/logout.svg" alt="Cerrar sesión" />
        <span>Cerrar sesión</span>
      </button>

       <button class="btn-historia-general" (click)="mostrarPacientesAtendidos()">
  Ver historias clínicas
</button>
    </div>
   
  </header>

    <!-- LISTA DE PACIENTES ATENDIDOS -->
<div class="overlay" *ngIf="listaPacientesVisible">
  <div class="modal-pacientes">
    <h2>Pacientes atendidos</h2>

    <div class="paciente-card" *ngFor="let p of pacientesAtendidos"
         (click)="verHistorias(p)">
      <img [src]="p.imagen1 || 'assets/imgs/default-user.png'" />
      <div>
        <p class="nombre">{{ p.nombre }} {{ p.apellido }}</p>
        <p class="dni">DNI: {{ p.dni }}</p>
      </div>
    </div>

    <button class="btn-cerrar" (click)="cerrarListaPacientes()">Cerrar</button>
  </div>
</div>

  <!-- BUSCADOR -->
  <input
    type="text"
    placeholder="Buscar por especialidad / paciente..."
    [(ngModel)]="filtroTexto"
    (input)="filtrarTurnos()"
    class="input-buscar"
  />

  <!-- FILTROS -->
  <section class="filtros">
    <button [class.activo]="filtro === 'pendiente'" (click)="cambiarFiltro('pendiente')">Pendientes</button>
    <button [class.activo]="filtro === 'aceptado'" (click)="cambiarFiltro('aceptado')">Aceptados</button>
    <button [class.activo]="filtro === 'rechazado'" (click)="cambiarFiltro('rechazado')">Rechazados</button>
    <button [class.activo]="filtro === 'realizado'" (click)="cambiarFiltro('realizado')">Realizados</button>
  </section>

  

  <!-- LISTA DE TURNOS -->
  <section class="turnos-lista">
    <div *ngIf="turnosFiltrados.length; else sinTurnos">
      <div class="turno-card" *ngFor="let turno of turnosFiltrados">

        <h3>{{ turno.especialidad }}</h3>
        <p><strong>Paciente:</strong> {{ turno.usuarios?.nombre }} {{ turno.usuarios?.apellido }}</p>
        <p><strong>Fecha:</strong> {{ turno.fecha | date: 'dd/MM/yyyy' }}</p>
        <p><strong>Hora:</strong> {{ turno.hora }}</p>
        <p class="estado" [ngClass]="turno.estado">{{ turno.estado | titlecase }}</p>

        
        <div class="acciones" *ngIf="turno.estado === 'pendiente'">
          <button class="btn-aceptar" (click)="aceptarTurno(turno)">Aceptar</button>
          <button class="btn-rechazar" (click)="rechazarTurno(turno)">Rechazar</button>
        </div>

        <div class="acciones" *ngIf="turno.estado === 'aceptado'">
          <button class="btn-realizado" (click)="abrirHistoriaClinica(turno)">Finalizar turno</button>
        </div>

        

        <div *ngIf="turno.resena">
          <p><strong>Reseña cargada:</strong> {{ turno.resena }}</p>
        </div>

      </div>
    </div>

    <ng-template #sinTurnos>
      <p class="sin-turnos">No hay turnos en esta categoría.</p>
    </ng-template>
  </section>

  <!-- MODAL RESEÑA -->
  <div class="modal-overlay" *ngIf="modalAbierto">
    

     <div class="modal">
  <h3>{{ modalTitulo }}</h3>
  

  <!-- Reseña -->
  <textarea
    [(ngModel)]="textoResenia"
    placeholder="Escriba su reseña..."
    class="input-textarea"
  ></textarea>

  <h4>Datos clínicos</h4>

  <!-- Altura -->
  <input
    type="number"
    [(ngModel)]="altura"
    placeholder="Altura (cm)"
    class="input-clinico"
  />

  <!-- Peso -->
  <input
    type="number"
    [(ngModel)]="peso"
    placeholder="Peso (kg)"
    class="input-clinico"
  />

  <!-- Temperatura -->
  <input
    type="number"
    [(ngModel)]="temperatura"
    placeholder="Temperatura (°C)"
    class="input-clinico"
  />

  <!-- Presión -->
  <input
    type="text"
    [(ngModel)]="presion"
    placeholder="Presión arterial"
    class="input-clinico"
  />

  <h4>Datos opcionales</h4>

  <!-- OPCIONAL 1 -->
  <div class="fila-opcional">
    <input type="text" [(ngModel)]="dato1.clave" placeholder="Clave 1" />
    <input type="text" [(ngModel)]="dato1.valor" placeholder="Valor 1" />
  </div>

  <!-- OPCIONAL 2 -->
  <div class="fila-opcional">
    <input type="text" [(ngModel)]="dato2.clave" placeholder="Clave 2" />
    <input type="text" [(ngModel)]="dato2.valor" placeholder="Valor 2" />
  </div>

  <!-- OPCIONAL 3 -->
  <div class="fila-opcional">
    <input type="text" [(ngModel)]="dato3.clave" placeholder="Clave 3" />
    <input type="text" [(ngModel)]="dato3.valor" placeholder="Valor 3" />
  </div>

  <button class="btn-guardar" (click)="guardarResenia()">Guardar reseña</button>
  <button class="btn-cerrar-modal" (click)="cerrarModal()">Cerrar</button>
</div>
  </div>


 <app-historia-clinica
  *ngIf="viendoPaciente"
  [paciente]="viendoPaciente"
  [historias]="historiasPaciente"
  [cerrar]="cerrarHistorias.bind(this)">
</app-historia-clinica>
</div>
